## Promise

同步执行虽然加载慢，但是代码简单；异步执行虽然加载块，但是代码及其复杂。为了让代码既可以简单又可以让加载不缓慢，就引入了Promise的概念。

Promise的最主要作用就是消除异步操作，本质还是异步操作，只不过用比较巧妙的手段处理了。用同步一样的方式来书写异步代码。

#### Promise怎么用

Promise是个函数，异步的代码都写在里面

## js执行队列

#### js是单线程

js语言的一大特点就是单线程，也就是说或同一个时间只能干一件事。因为js的使命就是处理页面中交互效果以及操作DOM而诞生的，比如对一个元素进行增删操作，必须是先增加元素，然后再删除，增加删除不能同时进行。

#### js单线程的弊端

js的单线程意味着所有任务都需要排队，前面一个任务结束才会执行后面一个任务，这样导致的问题就是如果js中某个程序执行的时间过长，那么就会造成页面的渲染不连贯，加载会异常阻塞的感觉。

#### 同步和异步概念

为了解决这种弊端，H5提出了Web Worker标准，允许js脚本创建多个线程来执行程序，所以就出现了同步和异步执行。

同步执行：在同一时间只能做一件事，比如现实中的烧水做饭。先花费10分钟烧水，水烧了再去切菜，然后再去炒菜，很显然这种执行机制不合理。

异步执行：再同一时间做多样事情，比如在烧水的10分钟内，把完成切菜和炒菜的过程，同一时间干3件事情，这种执行机制就效率高。

#### 同步任务

同步任务：JS把同步任务都放在主线程上执行，形成一个执行栈。

#### 异步任务

JS把回调函数都放在异步任务的任务队列也叫做消息队列上执行，一般而言，异步任务有以下三种类型

普通事件回调函数：如click，resize等

资源加载：如load，error等

定时器：如setInterval，setTimeout等

Ajax网络模块回调函数

#### js执行同步异步任务机制

把同步任务执行的主线程看作主车道，执行的都是不花费时间的；把异步任务执行的任务队列看作应急车道，主要都是修车 抛锚之类花费时间的操作；车修好之后再去主车道上走。

![1606376406372](../../../%25E5%2585%258B%25E6%259E%2597%25E8%25BE%25A3%25E8%2588%259E/AppData/Roaming/Typora/typora-user-images/1606376406372.png)

![1606377056083](../../../%25E5%2585%258B%25E6%259E%2597%25E8%25BE%25A3%25E8%2588%259E/AppData/Roaming/Typora/typora-user-images/1606377056083.png)

#### 执行步骤

1. js先将所有任务分为同步任务和异步任务。
2. 然后将同步任务放入主线程的执行栈里面，先执行主线程同步任务。当有异步任务的时候，将异步任务提交给相应的**异步进程处理**，只是提交过去暂不推入到任务队列中。
3. 当所有同步任务执行完毕的时候，系统就会依次读取存放在任务队列中的异步任务，然后将异步任务拿到主线程执行栈中执行。
4. 当任务队列中的异步任务读取完之后就是一个空的状态，如果这时候又有一个事件触发了，异步进程又把这个异步任务推入到任务队列中，这时候主线程执行栈会再次读取任务队列中的异步任务，并拿到主线程执行栈中执行。
5. ![1606379289160](../../../%25E5%2585%258B%25E6%259E%2597%25E8%25BE%25A3%25E8%2588%259E/AppData/Roaming/Typora/typora-user-images/1606379289160.png)

#### 异步进程处理

常见的需要异步进程处理的有：Ajax网络模块回调函数；DOM事件中的回调函数；定时器中的回调函数；window对象上的onload事件等

异步进程处理指的是只有当事件触发了或者定时器的间隔时间到了，该进程才会把异步任务推入任务队列（消息队列中），如果事件没有触发那就不会把异步任务推入到任务队列中。

#### 事件循环even loop

主线程执行完毕，重复不断的查询任务队列，获取任务并推入主线程执行任务的这个过程或者机制做事件循环(even loop)。