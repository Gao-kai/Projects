# 经典面试题：当用户在地址栏中输入网址，到最后看到页面，中间经历了那些过程？

### 基础知识：什么是客户端？什么是服务器端？
客户端：可以向服务器发出请求，并接受返回的内容进行处理的终端
服务器端：能够接收客户端请求，并且将相关资源信息返回给客户端的终端
一台电脑可以即是客户端又是服务器端

## 第一步：浏览器对URL地址进行解析
所谓URL地址解析，其实就是浏览器识别当前地址栏中的URL的过程。浏览器在解析完一个URL之后，便知道了使用什么协议，域名，端口号以及要请求的资源所在服务器的资源路径等信息。
### URI/URL/URN
+ URI：Uniform Resource Identifier 统一资源标识符 
  URL和URN是URI的子集，是一种从属关系，由于URN一般不常用，所以一般来说URI就代表URL的意思
+ URL: Uniform Resource Locator 统一资源定位符  根据这个地址能找到对应的资源,资源定位
+ URN: Uniform Rssource Name 统一资源名称 一般指国际上通用标准的一些名称

### 一个完整的URL所包含的内容
http://www.bilibili.com:80/video/index.html?name=lol&id=166966#demo

+ 传输协议 http://
传输协议就是能够把客户端和服务器通信的信息进行传输的工具，类似于快递员，当前常见的传输协议：
1. HTTP 超文本传输协议 Hyper Text Transfer Protocol
超文本的意思是传输的内容不仅仅是文本信息，可以是媒体资源文件（图片、音视频流文件）以及XML等多种格式的信息

2. HTTPS 更加安全的HTTP协议 Hyper Text Transfer Protocol over SecureSocket Layer
一般涉及支付的网站都需要采用https协议，末尾的s代表的是SSL，代表是运行在安全层之后的http传输协议

3. FTP 文件传输协议 
一般应用于把本地资源上传到服务器端的协议，一般用于传输较大的文件

服务器：服务器就是电脑，就是比我们日常用的电脑配置高很多的电脑，我们一般的电脑可能是8G内存500G存储一个CPU一个宽带接口；而服务器可能是32G内存2T存储4个CPU3个宽带接口，并且可以保证24小时运转工作的同时寿命比一般电脑长。

但是只有一台服务器也就是只有一台高配置的电脑，我们从客户端发起请求要获取B站的index.html这个网页资源，那么前提是服务器上的某个文件夹中存有这个html文件，所以有个问题就是我们如何把自己写好的代码也就是项目上传到服务器上呢？

不会自己买服务器，购买成本高而且维护成本高
所以现在都用阿里云或者腾讯云服务器，减少搭建服务器成本的同时减少了维护成本

而我们在家里将自己本地电脑上开发好的项目上传到远端的云服务器上，就用到ftp这个文件传输协议

FileZilla：FTP上传文件工具，通过这个工具和FTP传输协议，我们可以将本地的文件上传到服务器端，这种工具有很多很多
	
+ 域名 www.bilibili.com 
域名其实就是一个方便让用户记忆的名字。当我们给服务器（配置高的电脑）通网之后，会有两个IP地址。
	内网IP:局域网内可以基于此IP访问到服务器
	外网IP：外部用户可以基于此IP访问到服务器，比如112.45.120.1。也就是说没有域名其实也可以访问到这台服务器上的资源，比如直接使用服务器的外网IP也可以，但是外网IP是一串很难记忆的数字，为了方便人们记忆，所以需要给外网IP地址一个容易记忆的名字，这个方便记忆的名字就是域名

C:\Users\克林辣舞>ping www.bilibili.com
正在 Ping a.w.bilicdn1.com [112.45.120.1] 具有 32 字节的数据
那么就可以知道bilibili的服务器的外网IP地址是：112.45.120.1


顶级域名 qq.com 所有的资源都在这个域下
一级域名 www.qq.com www开头的域名
二级域名 sports.qq.com 
三级域名 kbs.qq.com
.com 国际域名 业务偏向于国际那么适用于.com
.cn 中文域名 业务偏向于国内那么适用于.cn
.com.cn 
.edu 教育
.gov 国家或政府单位
.io  博客
.org 官方组织 jquery.org
.net 系统类 OA系统 ERP系统

域名需要花钱购买的，购买域名指的是购买顶级域名。对于腾讯来说，只需要购买qq.com这个顶级域名 所有一级二级三级域名都是基于这个顶级域名来自己分配的。
购买域名去wanwang.aliyun.com这个网站购买，可以购买一个自己名字的域名用于以后搭建个人博客。

+ 端口号 :80
端口号的取值范围：0~65535 这个区间内的任意一个数字都可以用做端口号
一台服务器可以存放多个项目资源，当用户通过域名/外网IP地址找到服务器之后，如何让用户找到不同的项目资源呢？此时就需要端口号来实现，也就是用端口号来区分同一台服务器上的不同项目。
http请求默认端口号：80
https请求默认端口号：443
ftp请求默认端口号：21
如果项目采用的就是默认端口号，我们在写地址的时候可以不用加端口号，浏览器在发送请求的时候会帮我们默认在requestURL中默认加上端口号。

+ 请求资源路径名称 /video/index.html 客户端告诉服务器要请求的资源路径名称

服务器接收到请求后做的几件事情：
1. 根据端口号找到对应的项目
2. 根据请求资源路径名称找到资源文件
3. 读取资源文件内容
4. 将资源文件内容返回

默认的路径或者名称 xxx.com/stu/ 客户端请求时不指定具体的资源名，这时候服务器会找默认的资源文件并将其返回给客户端，至于这个默认的资源文件是需要我们自己在服务器配置的，一般默认的资源名是default.html或者index.html，如果默认资源也找不到就返回404not found

注意伪URL地址的处理（重点是伪URL）
在京东打开一个商品的详情页url是：https://item.jd.com/100013599549.html
但是在jd的服务器上并没有名为100013599549.html的这个文件，真实的路径应该是：
https://item.jd.com/index.php?id=100013599549

所以说上面这个商品详情页的URL地址是一个伪URL地址，服务端在接受到这种请求的时候会将其转化为id=xxx的形式去查询服务器上的资源并返回，而之所以这样做的目的在于SEO搜索引擎优化，因为index.php?这种地址是动态网址，这种网址是不可以被搜索引擎所收录的，所以我们需要将动态网址静态化，此时需要将URL进行重写，这种技术也可以被称之为URL重写技术，这个技术是后端来写的，可以创建一套url过滤的规则去重写；也可以走301或者302重定向来实现。

+ 查询参数 ?name=lol&id=166966
客户端想把信息传递给服务器，有两大类方法：
1. URL地址中通过问号查询参数传递参数
2. 通过请求报文传输，这其中又分为请求头和请求主体

查询参数还有一个作用就是实现不同页面之间的信息交互
例如从一个商品列表到商品详情页，当我们在一个商品列表中点击任意一个商品，都会跳转到相同的详情页，但是每一个商品的详情信息是不同的，实现这种信息交互就需要依赖查询参数，比如在进入详情页的时候在地址后面拼接一个查询参数?id=xxx

+ 哈希值 #demo
哈希值也能充当信息传输的方式，但是一般情况下我们都用查询参数来传输
哈希值最主要的用途在于锚点定位，比如xxx.com/#nba和/#cba，页面刷新后的哈希值不同就会直接滚动到对应nba和cba的区域直接呈现给用户
基于哈希值实现路由管控，前端的哈希路由就是基于哈希值来实现的，展示不同的组件和模块

### URL特殊字符编码处理
以下两种编码解码的方法，在浏览器端支持而且在服务器端也是支持的，所以在客户端和服务器进行信息传输的时候，如果需要对请求的地址和信息进行编码，我们则基于以上两种方式进行处理，由于服务器也存在这些方法所以可以在客户端和服务端进行统一编码解码。

#### 1. 对URL地址中非有效Unicode编码 如空格 中文 特殊符号的编码和解码
默认情况下，如果一个请求的URL地址中出现了非有效Unicode编码内容，现代的浏览器会默认的对这些特殊字符进行编码，浏览器会基于encodeURI进行编码，反过来我们可以基于decodeURI进行解码。

> 一般情况下我们用encodeURI编码的时候会对整个URL进行编码，因为这样子整个URL中的特殊字符都会自动编码

比如：'https://www.bilibili.com/video?name=cat——小乖乖' 
这个URL地址包含特殊符号——以及中文
```js
encodeURI('https://www.bilibili.com/video?name=cat——小乖乖')
编码结果为：'https://www.bilibili.com/video?name=cat%E2%80%94%E2%80%94%E5%B0%8F%E4%B9%96%E4%B9%96'

反过来解码：decodeURI('https://www.bilibili.com/video?name=cat%E2%80%94%E2%80%94%E5%B0%8F%E4%B9%96%E4%B9%96')
解码结果为：'https://www.bilibili.com/video?name=cat——小乖乖'
```


#### 2. 对URL地址中又包含了一个URL地址编码 如一个URL中有两个http://的url
比如：'https://www.bilibili.com/video?from=http://www.baidu.com'
这个URL地址的查询参数from的值又是一个合法的URL地址，对于浏览器来说，这种地址浏览器无法识别哪一个是真正的有效请求地址，所以为了避免这种问题的出现，我们要对其进行编码。

> encodeURIComponent相对于encodeURI来说，不用于整个URL编码，而是对URL中的某一部分进行编码，一般是对URL中问号传参的值进行编码。

```js
使用encodeURIComponent()方法进行编码：
https://www.bilibili.com/video?from=encodeURIComponent('http://www.baidu.com')
编码之后的URL地址为：'https://www.bilibili.com/video?from=http%3A%2F%2Fwww.baidu.com'

使用decodeURIComponent()方法进行解码：
decodeURIComponent('https://www.bilibili.com/video?from=http%3A%2F%2Fwww.baidu.com')
解码之后的地址为：'https://www.bilibili.com/video?from=http://www.baidu.com'
```

#### 3. 针对于中文的编码方式escape(仅浏览器端支持)
escape/unescape方法仅仅适用于客户端，服务器端不一定有这种方法。所以这个方法只可用于客户端页面之间信息传递时进行编码和解码处理。
对中文进行编码：escape('小乖乖') => '%u5C0F%u4E56%u4E56'
对中文进行解码: unescape('%u5C0F%u4E56%u4E56') => '小乖乖'

> 一般用于前端页面间互相传递中文参数时基于这种方法解码编码
> 在浏览器端存的cookie信息，如果信息中包含中文，也可以基于这个方法编码解码

### 使用JS实现页面跳转
+ 获取当前页面的URL地址 window.location.href
+ 从当前页面直接跳转到某个页面URL地址 window.location.href = "https://www.baidu.com/"
+ 打开一个新的标签页，然后跳转到某个URL window.open("https://www.baidu.com")


## 第二步：DNS服务器域名解析（找到服务器地址）
1. 什么是DNS？
DNS服务器：即域名解析服务器(Domain name resolution),在这个服务器上存储着域名和服务器外网IP一一对应的相关记录。我们在购买域名之后需要将域名和我们的服务器外网IP地址进行关联，关联完成之后就代表在DNS服务器上保存了一条域名和外网IP地址的一一对应记录。

2. DNS域名解析(基于域名查找对应服务器外网IP的过程)
浏览器在经过上一步的URL地址解析之后，已经知道了要请求的服务器的域名，但是域名只是一个方便人们记住服务器的名称，所以客户端在发送请求时的DNS解析，其实就是根据浏览器解析出来的域名在DNS服务器上查找到对应服务器的外网IP的过程。

3. 关于DNS的性能优化——DNS预获取（DNS Prefetch）

DNS优化的三个方面：
+ 使用浏览器DNS本地缓存
一般浏览器会在第一次对某个域名进行解析之后，会在本地默认建立一个DNS缓存记录，这个记录的时间很短只有1min左右，如果在这个时间内又访问了该域名，那么此时浏览器会直接读取本地DNS解析缓存记录中的值，而不会再去DNS域名服务器进行域名解析。

+ 减少一个页面中的DNS解析次数
一个网站中，我们需要发送请求的域名和服务器尽可能的少

+ 做DNS预获取 dns-prefetch
在页面开始加载的时候，就把当前页面中需要访问其他域名所对应的服务器信息进行提前DNS解析，等到页面加载到具体内容部分就可以直接获取不用再等待DNS解析了。

以京东官网为例：当我们在访问www.jd.com的时候，会首先对www.jd.com这个域名进行解析找到对应的服务器外网IP地址，同时基于link标签的rel=dns-prefetch属性，对jd首页中其他要请求的域名提前进行dns解析，等到后面加载到对应资源的时候，就可以直接访问对应服务器而减少DNS解析的所消耗的时间了。
```js
<link rel="dns-prefetch" href="//static.360buyimg.com"/>
<link rel="dns-prefetch" href="//misc.360buyimg.com"/>
<link rel="dns-prefetch" href="//img10.360buyimg.com"/>
<link rel="dns-prefetch" href="//img11.360buyimg.com"/>
<link rel="dns-prefetch" href="//img12.360buyimg.com"/>
<link rel="dns-prefetch" href="//img13.360buyimg.com"/>
```


## 第三步：客户端和服务端建立TCP连接（三次握手）
这一步的目的是在发起真正的的HTTP请求之前，先确认传输通道是否通畅并且确认客户端和服务端都可以接受到对方的信息。

TCP网络协议
HTTP传输协议

SYN=1 seq=J 这个J可以自定义
SYN=1 ACK=1 ack=J+1 seq=K
ACK=1 ack=K+1

第一次握手
第二次握手
第三次握手


## 第四步：客户端把信息传递给服务器（发送HTTP请求）
建立TCP连接的三次握手就好比修路，在A到B的距离中保持路的通畅
路修好之后车子开过去的过程就代表发起HTTP请求
车子开过去的过程中需要携带一部分东西，这些东西就是HTTP请求中的请求报文

### HTTP请求报文
HTTP请求报文：所有经过传输协议，客户端传递给服务器的内容都被称之为请求报文
HTTP响应报文：所有经过传输协议，服务端返回给客户端的内容都被称之为响应报文

HTTP请求报文组成：
+ 起始行
+ 请求头（请求首部）
> Accept:客户端允许接收的类型
> Cache-Control:强缓存
> User-Agent:当前浏览器的信息
> Cookie
> Connection:keep-alive 代表tcp的长连接
+ 请求主体

HTTP响应报文组成：
+ HTTP状态码
+ 响应头
> Connection:keep-alive 代表tcp的长连接
> Date:这个时间是服务端返回信息那一刻的时间，客户端在拿到返回信息的时间是一定会和这个时间有一定偏差的
> ETag:304协商性缓存
+ 响应主体

### 强缓存和协商缓存


## 第五步：服务器得到并处理请求（响应HTTP请求返回信息给客户端）

### 如何构建一个网站？
1. 一个web项目的前端代码和后端代码开发完成
2. 购买服务器 阿里云ECS独立主机服务器
3. 将项目部署到服务器
 + 把项目资源利用FTP工具上传到服务器
 + 基于tomcat/appache/iis/nginx/node等工具构建一个web服务器
4. 构建web服务器的核心流程
 + 指定项目的在服务器的资源目录路径
 + 指定端口号 一般为80/443 这样做的目的是服务器上除了项目需要的环境之外其余任何东西都不需要安装，这样做的目的是保证绝对安全和默认端口号不被其他应用程序所占用
 + 指定默认页 当请求的路径不存在的时候 默认返回一个页面
 + 指定错误页 每一个错误码都对应一个错误页面
 + 指定服务端支持的资源文件类型MIME类型
5. 以上这些步骤等于创建了一个服务，后面接收到客户端的请求之后，会由这个服务负责接收请求，查找对应的资源文件，最后把信息返回给客户端。
> 一个服务器从理论上来说最多可以创建65536个服务，因为端口号的范围是0-65535，总共63336个数
6. 购买域名并进行DNS域名解析，将购买的域名和自己的服务器外网IP地址对应起来
7. 只要是大陆服务器就需要到工信部备案 个人可基于第三方平台可代理备案

### 服务器的几种分类

1. WEB服务器（接收客户端的请求，根据请求的信息找到对应的资源文件并将其返回给客户端，那么web服务器的活就干完了）
WEB服务器又可以细分为静态资源服务器、图片服务器、音视频服务器
+ 静态资源服务器就是css/js/html这些静态文件
+ 图片服务器放置的都是图片文件
+ 音视频服务器放置的都是音视频流文件 多用于直播

> 网络直播的流程
摄像机录像产生音视频文件
将音视频文件实时传递到音视频服务器
音视频服务器将音视频文件转化为流文件
客户端建立和音视频服务器的长连接
音视频服务器将流媒体源源不断的传输到客户端
用户在自己的手机上就可以看到现场直播

网络直播走的是服务器，电视直播走的是卫星，所以网络直播比电视直播慢

2. 数据服务器（接收客户端的请求，执行相关的程序来处理请求。并且根据请求从数据库中读取到所请求的数据，拿到数据之后把数据进行二次的重构和封装，然后把数据返回给客户端）
+ 接收客户端的请求并分析处理该请求需要对数据执行何种操作
+ 基于SQL语句对数据库中的数据进行增删改查
+ 如果是查询操作，那么需要把获取的数据进行处理分析格式化操作，变成客户端需要的数据格式
+ 如果和写入操作，需要把数据写入数据库
+ 把数据处理的结果返回给客户端，以上这些所有的操作都是基于后端语言的代码来完成的

数据服务器的磁盘中放的是后端的程序
数据服务器中的核心是对数据库进行增删改查

### 同源策略和跨域
一般来说：
如果数据服务器和WEB服务器在同一台机器上的相同服务下，也就是协议、域名和端口号都相同，那么这种请求是同源策略请求，同源策略请求基于AJAX来实现；

如果数据服务器和web服务器不再同一台机器上，那么这种请求和非同源策略请求，也就是跨域。

正因为实际项目中的数据服务器和web服务器不再同一服务下，所以客户端需要向不同的服务器发送请求获取资源，一旦服务器多了之后每次请求都需要DNS域名解析，为了减少域名解析的时间，所以我们在一开始的时候使用DNS预解析dns-prefetch技术来预先进行域名解析。

### HTTP状态码
所有HTTP状态码都是1-5开头，并且都是3位数字
>1开头的一般代表通知，一般不会遇到

>2开头的代表成功
+ 200 OK 成功
+ 201 CREATED 一般应用于告诉服务器创建一个新文件，最后服务器创建成功后返回的状态码
+ 204 NO CONTENT 对于PUT POST DELETE请求，服务器拒绝处理，可以返回空内容并且用204状态码告知客户端

>3开头的也代表成功 只是需要一定的转移
+ 301 Moved Permanently 永久重定向 
举例：访问京东原来的域名www.360buy.com,会返回一个301状态码并重定向到www.jd.com
一般应用于服务器转移或者域名转移的时候用301，表示所请求的资源已经被永久转移到新的URL，新的URL会在响应头的location字段中找到

+ 302 Found 
+ 307 Moved Temporarily 临时重定向
302和307代表的都是请求的资源资源临时发生了改变，以后请求的时候还得用原来的URL请求
307的应用主要用于服务器的负载均衡，比如超出一个服务器的最大负载之后，那么将后续的请求都转移到另外一台服务器进行处理，如果没有超出那么还是用一台服务器处理即可，这种技术就是服务器的负载均衡技术。

+ 304 Not Modifield 设置HTTP的协商缓存 
第一次请求到某个资源之后，将其缓存到本地，第二此请求的时候直接读取本地的，大大减少服务器的压力
HTTP的协商缓存需要前端和后端一起配合才可以实现

> 4开头的代表客户端失败 
+ 400 Bad Request 客户端传给服务端的参数错误
+ 401 Unauthorized 无权限访问
+ 404 Not Found 请求地址错误

> 5开头的代表服务端失败
+ 500 Internal Server Error 未知的服务器错误
+ 503 Service Unavailable 服务器超负荷

## 第六步：客户端渲染页面
浏览器是多线程的，但是浏览器的JS解析引擎工作的时候是自上而下单线程的

### 常见的meta标签有哪些
1. 代表此页面使用utf-8编码
<meta charset="utf-8"> 

2. 代表在IE浏览器中渲染此页面的时候使用最新edge内核进行渲染 
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

3. 设置用于SEO的关键字 适合搜索引擎优化
<meta name="keywords" content="篮球,足球,nba,网球,排球" />

4. 设置用于SEO的描述  适合搜索引擎优化
 <meta name="description" content="珠峰培训是中国前端开发培训知名品牌，十二年专注web前端培训，以专注立身，学习考试通过后再交学费，四周内无条件退学费；70%学员来自口碑推荐，强大的师资团队，最深入的课程体系，以学生为信仰的教学理念。我们专注的特色web培训有：HTML5培训,node.JS培训,前端开发培训,前端培训,移动端培训,react培训,Vue培训,webpack培训,ReactNative培训" />
 
5. 设置页面的宽度为视口宽度，不可缩放，最大缩放比和最小缩放比以及初始缩放比
 <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
 
6. 设置开启了dns预解析 后续的诸如img.zhufengpeixun.cn域名提前进行域名解析
 <meta http-equiv='x-dns-prefetch-control' content='on'>
 <link rel="dns-prefetch" href='http://img.zhufengpeixun.cn'>
 
### 当浏览器遇到不同标签的操作
遇到link、video、audio、img这些标签的时候，浏览器会分配一个新的线程去加载这些资源，主线程不会阻塞，所以这些资源的加载是异步加载的。

遇到scripe标签或者@import的时候，浏览器的主线程会暂时停止渲染页面，而是先记载资源信息，加载完成之后再开始继续渲染页面，所以script标签的加载是同步加载的，这也是我们要把script标签放置在页面最底部的原因，因为script一来会阻塞页面视图的渲染，另外一个会导致js里面操作dom的代码执行的时候报错，因为这时候有可能dom结构还没有加载完成。

> 所以尽可能的使用link而不用@import来引入css文件

### 渲染的流程 后面详细解读
### 重绘和回流
重绘是painting，回流和Layout
重绘代表元素的颜色、字体、粗细发生了变化，但是位置没有发生变化

回流（也叫做重排）代表元素的大小、宽度或者位置发生了改变，也就是页面的布局和几何信息发生变化的时候，此时会触发页面的重新布局也就是回流，浏览器会重新计算dom树，然后合成render树，重新绘制paint页面。

回流一定引起重绘，重绘不一定引起回流。所以在操作dom的时候，如果一定要改变元素的样式，那么使用重绘的情况下不要使用回流来解决，因为这会造成性能的浪费。

### 前端性能优化之：避免dom的回流或者重绘




## 第七步：客户端和服务端断开TCP连接（四次挥手）